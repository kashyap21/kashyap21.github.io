if (self.CavalryLogger) { CavalryLogger.start_js(["+2mYs"]); }

__d("PhotoTagApproval",["Arbiter","CSS","DOM","Event","Parent","PhotosConst","ge"],(function(a,b,c,d,e,f){__p&&__p();function a(a){"use strict";__p&&__p();this.viewer=a;this.units=[];this.currentUnit=0;var c=a.getVersionConst();c==b("PhotosConst").VIEWER_SNOWLIFT?this._root=b("ge")("fbPhotoSnowliftTagApproval"):this._root=b("ge")("fbPhotoPageTagApproval");b("Arbiter").subscribe(a.getEventString("DATA_CHANGE"),this.restartTagApproval.bind(this));b("Arbiter").subscribe("PhotoTagApproval.PENDING_TAG_PHOTO_CLICK",this.pendingTagPhotoClick.bind(this));b("Event").listen(this._root,"click",this.handleClick.bind(this));b("Event").listen(this._root,"mousemove",function(a){this.hiliteCurrentPendingTag(),b("Event").kill(a)}.bind(this));this.restartTagApproval()}a.prototype.handleClick=function(event){"use strict";__p&&__p();var a=event.getTarget();if(b("CSS").hasClass(a,"nextPager")&&b("CSS").hasClass(a,"enabled"))this.showNextUnit();else if(b("CSS").hasClass(a,"prevPager")&&b("CSS").hasClass(a,"enabled"))this.showPrevUnit();else if(b("Parent").byClass(a,"fbPhotoApprovalPendingButtons")){var c=this.units[this.currentUnit];c=this.getTagNameID(c);if(c){a=b("Parent").byClass(a,"approve");b("Arbiter").inform("PhotoTagApproval.UPDATE_TAG_BOX",{id:c,approve:a,version:this.viewer.getVersionConst()})}setTimeout(this.removeSelectedUnit.bind(this),0)}return!0};a.prototype.loadUnits=function(a){"use strict";this.units=b("DOM").scry(this._root,"div.fbPhotoApprovalUnit"),this.units.length?(b("CSS").show(this._root),this.showUnit(a),b("CSS").conditionClass(this._root,"hidePagers",this.units.length==1)):(b("CSS").hide(this._root),b("Arbiter").inform("PhotoTagApproval.HILITE_TAG",{tag:null,version:this.viewer.getVersionConst()}))};a.prototype.restartTagApproval=function(){"use strict";this.loadUnits(0)};a.prototype.pendingTagPhotoClick=function(a,c){"use strict";__p&&__p();if(c.version!==b("PhotosConst").VIEWER_PERMALINK&&c.version!==b("PhotosConst").VIEWER_SNOWLIFT)return!0;a="approve:"+c.id;for(var c=0;c<this.units.length;c++)if(this.units[c].id===a){this.showUnit(c);return!1}return!0};a.prototype.removeSelectedUnit=function(){"use strict";var a=this.units[this.currentUnit];b("DOM").remove(a);this.loadUnits(this.currentUnit)};a.prototype.showNextUnit=function(){"use strict";this.showUnit(this.currentUnit+1)};a.prototype.showPrevUnit=function(){"use strict";this.showUnit(this.currentUnit-1)};a.prototype.getTagNameID=function(a){"use strict";var b=a.id.indexOf(":");return a.id.slice(b+1)};a.prototype.showUnit=function(a){"use strict";this.units.forEach(b("CSS").hide);this.currentUnit=(a+this.units.length)%this.units.length;a=this.units[this.currentUnit];b("CSS").show(a);this.hiliteCurrentPendingTag();b("CSS").conditionClass(b("DOM").find(this._root,"a.prevPager"),"enabled",this.currentUnit>0);b("CSS").conditionClass(b("DOM").find(this._root,"a.nextPager"),"enabled",this.currentUnit<this.units.length-1)};a.prototype.hiliteCurrentPendingTag=function(){"use strict";var a=this.units[this.currentUnit];a=this.getTagNameID(a);b("Arbiter").inform("PhotoTagApproval.HILITE_TAG",{tag:a,version:this.viewer.getVersionConst()})};e.exports=a}),null);