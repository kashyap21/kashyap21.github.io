if (self.CavalryLogger) { CavalryLogger.start_js(["z420H"]); }

__d("PhotoViewerFollow",["Arbiter","AsyncRequest","BanzaiODS","CSS","DOM","Event","Parent","PhotosConst","$","collectDataAttributes"],(function(a,b,c,d,e,f){__p&&__p();var g={};function h(a){"use strict";this.FOLLOW_LOCATION_PHOTO=48,this.viewer=a}h.prototype.init=function(a,c,d,e,f,g,h){"use strict";this.subscribeLink=a,this.unsubscribeFlyout=c,this.subscribeEndpoints=f,this.unsubscribeEndpoints=g,this.unsubLinks=e,this.unsubDiv=d,this.reset(),this.activate(),this.type=h,b("Event").listen(this.subscribeLink,"click",function(event){b("Parent").byClass(event.getTarget(),"photoViewerFollowLink")&&this.subscribePhotoOwner()}.bind(this)),b("Event").listen(this.unsubLinks.user,"click",this.unsubscribePhotoOwner.bind(this)),b("Event").listen(this.unsubLinks.page,"click",this.unsubscribePhotoOwner.bind(this)),b("Arbiter").subscribe(["FollowUser","FollowUserFail","UnfollowUser","UnfollowUserFail"],this.updateSubscribe.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("DATA_CHANGE"),this.showSubscribeLinkOnChange.bind(this)),this.viewer.getVersionConst()===b("PhotosConst").VIEWER_SNOWLIFT&&(b("Arbiter").subscribe(this.viewer.getEventString("CLOSE"),this.reset.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("OPEN"),this.activate.bind(this))),this.registerUnsubscribeTarget()};h.prototype.activate=function(){"use strict";this.activated=!0};h.prototype.reset=function(){"use strict";this.unsubscribeFlyout&&this.unsubscribeFlyout.clearNodes(),this.subscriptionChange={},this.activated=!1};h.prototype.registerUnsubscribeTarget=function(){"use strict";if(!this.unsubscribeFlyout)return;var a=b("DOM").scry(this.subscribeLink,".photoViewerFollowedMsg")[0];a&&!b("CSS").hasClass(a,"unsubFlyoutEnabled")&&(this.unsubscribeFlyout.initNode(a),b("CSS").addClass(a,"unsubFlyoutEnabled"))};h.prototype.updateSubscribe=function(a,b){"use strict";if(!this.activated)return;b=b.profile_id;b&&(this.subscriptionChange[b]=a==="FollowUser"||a==="UnfollowUserFail"?"following":"unfollowed",this.toggleSubscribeLink(b))};h.prototype.showSubscribeLinkOnChange=function(a,c){"use strict";this.type=c.ownertype,b("CSS").conditionClass(this.unsubDiv,"isPage",this.type==="page"),this.toggleSubscribeLink(c.owner)};h.prototype.toggleSubscribeLink=function(a){"use strict";var c=b("DOM").scry(this.subscribeLink,"span.fbPhotoSubscribeWrapper")[0];if(!c)return;this.subscriptionChange[a]&&(b("CSS").conditionClass(c,"followingOwner",this.subscriptionChange[a]==="following"),this.subscriptionChange[a]==="unfollowed"&&(this.unsubscribeFlyout&&this.unsubscribeFlyout.hideFlyout(!0)));this.registerUnsubscribeTarget()};h.prototype.subscribePhotoOwner=function(){"use strict";__p&&__p();if(!this.viewer.getOwnerId())return;var a=this.type==="user"?{profile_id:this.viewer.getOwnerId()}:{fbpage_id:this.viewer.getOwnerId(),add:!0,reload:!1,fan_origin:"photo_snowlift"};b("Arbiter").inform("FollowUser",{profile_id:this.viewer.getOwnerId()});this.type==="page"&&b("BanzaiODS").bumpEntityKey("snowlift_page_like","snowlift_page_like.clicked_link");a.location=this.FOLLOW_LOCATION_PHOTO;var c=event.getTarget();c&&Object.assign(a,{ft:b("collectDataAttributes")(c,["ft"]).ft});new(b("AsyncRequest"))(this.subscribeEndpoints[this.type]).setAllowCrossPageTransition(!0).setData(a).setMethod("POST").setReadOnly(!1).setErrorHandler(b("Arbiter").inform.bind(null,"FollowUserFail",a)).send()};h.prototype.unsubscribePhotoOwner=function(){"use strict";if(!this.viewer.getOwnerId())return;var a=this.type==="user"?{profile_id:this.viewer.getOwnerId()}:{fbpage_id:this.viewer.getOwnerId(),add:!1,reload:!1};b("Arbiter").inform("UnfollowUser",{profile_id:this.viewer.getOwnerId()});a.location=this.FOLLOW_LOCATION_PHOTO;var c=event.getTarget();c&&Object.assign(a,{ft:b("collectDataAttributes")(c,["ft"]).ft});new(b("AsyncRequest"))(this.unsubscribeEndpoints[this.type]).setAllowCrossPageTransition(!0).setData(a).setMethod("POST").setReadOnly(!1).setErrorHandler(b("Arbiter").inform.bind(null,"UnfollowUserFail",a)).send()};h.createInstance=function(a,c,d,e,f,i,j,k){"use strict";a=a.getInstance();var l=new h(a);l.init(b("$")(c),d,e,f,i,j,k);g[a.getVersionConst()]=l;return l};h.getInstance=function(a){"use strict";return g[a]};e.exports=h}),null);