if (self.CavalryLogger) { CavalryLogger.start_js(["rSFAK"]); }

__d("FaceboxSourceConstants",[],(function(a,b,c,d,e,f){e.exports={SNOWLIFT_SUGGEST:"snowlift_suggest",SNOWLIFT_DISMISS:"photo_snowlift_unit_suggestions",PERMALINK_SUGGEST:"permalink_suggest",PERMALINK_DISMISS:"photo_permalink_suggestions",UPLOADER_SUGGEST:"uploader_suggest",UPLOADER_DISMISS:"album_uploader_suggestions"}}),null);
__d("LegacyMentionsInput.react",["cx","FocusListener","Bootloader","Event","Keys","React","ReactDOM","TypeaheadMetricsConfig"],(function(a,b,c,d,e,f,g){__p&&__p();var h;b("FocusListener");c=b("React").PropTypes;d=babelHelpers.inherits(a,b("React").Component);h=d&&d.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=h.constructor).call.apply(a,[this].concat(e)),this.hasEnteredText=function(){return!!(this.$2&&this.$2.getValue().trim())}.bind(this),this.submitComment=function(event){__p&&__p();var a;if(event)a=event.target.value&&event.target.value.trim();else{var c=b("ReactDOM").findDOMNode(this.refs.textarea);c.value&&c.value!==c.placeholder&&(a=c.value)}a=a||"";c={visibleValue:a,encodedValue:a};this.$2&&(c.encodedValue=this.$2.getRawValue().trim());c=this.props.onEnterSubmit(c,event);c&&this.$2&&(this.$2.reset(),event&&event.preventDefault())}.bind(this),this.$3=function(event){var a=event.nativeEvent;a=b("Event").getKeyCode(a)==b("Keys").RETURN&&!b("Event").$E(a).getModifiers().any;var c=this.$2&&this.$2.getTypeahead().getView().getSelection();this.props.onEnterSubmit&&a&&!c&&this.submitComment(event)}.bind(this),this.$4=function(){this.props.onFocus&&this.props.onFocus(),this.$1(b("ReactDOM").findDOMNode(this.refs.root))}.bind(this),this.$5=function(){this.props.onBlur&&this.props.onBlur()}.bind(this),this.$1=function(a){__p&&__p();if(this.props.disableInitTextarea||this.$2||this.$6)return;this.$6=!0;b("Bootloader").loadModules(["CompactTypeaheadRenderer","ContextualTypeaheadView","InputSelection","MentionsInput","TextAreaControl","Typeahead","TypeaheadAreaCore","TypeaheadBestName","TypeaheadHoistFriends","TypeaheadMetrics","TypeaheadMetricsX","TypingDetector","UFIComments"],function(c,d,e,f,g,h,i,j,k,l,m,n,o){__p&&__p();o=b("ReactDOM").findDOMNode(this.refs.textarea);new g(o);if(this.props.onTypingStateChange){g=new n(o);g.init();g.subscribe("change",this.props.onTypingStateChange)}n={autoSelect:!0,renderer:c,causalElement:o,autoflip:this.props.autoflip};this.props.viewOptionsTypeObjects&&(n.typeObjects=this.props.viewOptionsTypeObjects);this.props.viewOptionsTypeObjectsOrder&&(n.typeObjectsOrder=this.props.viewOptionsTypeObjectsOrder);g=new h(this.props.datasource,{ctor:d,options:n},{ctor:i},b("ReactDOM").findDOMNode(this.refs.typeahead));c=[j,k];if(b("TypeaheadMetricsConfig").gkResults){d=new m({extraData:{event_name:"mention_metric_x"}});d.init(g)}n=new l({extraData:{event_name:"mentions",from_location:"comments"}});h.initNow(g,c,n);this.$2=new f(a,g,o,{hashtags:this.props.hashtags});this.$2.init({},this.props.initialData);this.props.initialData&&e.set(o,o.value.length);this.props.onPaste&&b("Event").listen(o,"paste",this.props.onPaste);this.props.onContentChange&&(this.$7=this.$2.subscribe("valueUpdate",function(a,b){a=b.value;this.props.onContentChange(a)}.bind(this)));this.$6=!1}.bind(this),"LegacyMentionsInput.react")}.bind(this),this.focus=function(){try{b("ReactDOM").findDOMNode(this.refs.textarea).focus()}catch(a){}}.bind(this),c}a.prototype.componentDidMount=function(){"use strict";this.props.initialData&&this.$1(b("ReactDOM").findDOMNode(this))};a.prototype.getText=function(){"use strict";return this.$2&&this.$2.getRawValue().trim()};a.prototype.componentWillUnmount=function(){"use strict";this.$2&&this.$7&&this.$2.unsubscribe(this.$7)};a.prototype.render=function(){"use strict";var a="textInput mentionsTextarea uiTextareaAutogrow uiTextareaNoResize UFIAddCommentInput _2xww";return b("React").createElement("div",{ref:"root",className:"uiMentionsInput textBoxContainer ReactLegacyMentionsInput _2xwx"},b("React").createElement("div",{className:"highlighter"},b("React").createElement("div",null,b("React").createElement("span",{className:"highlighterContent hidden_elem"}))),b("React").createElement("div",{ref:"typeahead",className:"uiTypeahead mentionsTypeahead"},b("React").createElement("div",{className:"wrap"},b("React").createElement("input",{type:"hidden",autoComplete:"off",className:"hiddenInput"}),b("React").createElement("div",{className:"innerWrap"},b("React").createElement("textarea",{ref:"textarea",name:"add_comment_text",className:a,title:this.props.placeholder,placeholder:this.props.placeholder,onFocus:this.$4,onBlur:this.$5,onKeyDown:this.$3})))),b("React").createElement("input",{type:"hidden",autoComplete:"off",className:"mentionsHidden",defaultValue:""}))};a.propTypes={initialData:c.object,disableInitTextarea:c.bool,placeholder:c.string,datasource:c.object,ref:c.string,viewOptionsTypeObjects:c.object,viewOptionsTypeObjectsOrder:c.array,hashtags:c.bool,autoflip:c.bool,onEnterSubmit:c.func,onFocus:c.func,onBlur:c.func,onContentChange:c.func,onTypingStateChange:c.func,onPaste:c.func};e.exports=a}),null);
__d("PhotoAlbumPlacesTypeahead",["Arbiter"],(function(a,b,c,d,e,f){__p&&__p();function g(a){"use strict";__p&&__p();if(!a)return;if(a.getCore().getHiddenValue()){var c={uid:a.getCore().getHiddenValue(),text:a.getCore().getValue()};b("Arbiter").inform("PhotoAlbumPlacesTypeahead.EXIST_PLACE",c)}a.subscribe("select",function(c,a){b("Arbiter").inform("PhotoAlbumPlacesTypeahead.SELECTED_PLACE",a.selected)}.bind(this));a.subscribe("reset",function(){a.getCore().getHiddenValue()||b("Arbiter").inform("PhotoAlbumPlacesTypeahead.RESET_PLACE")}.bind(this));a.subscribe("focus",function(){b("Arbiter").inform("PhotoAlbumPlacesTypeahead.FOCUSED")}.bind(this));this._initialized=!0}g.prototype.init=function(a){"use strict";if(this._initialized)return;g.call(this,a)};e.exports=g}),null);
__d("PhotosTaggingWaterfall",["AsyncSignal"],(function(a,b,c,d,e,f){function g(a){g._queueName=a||g._queueName}Object.assign(g,{BEGIN:"begin",TAG_FACE:"tag_face",HOVER_TAG_FACE:"hover_tag_face",SHOW_SUGGEST:"show_suggest",ADD_NAME:"add_name",TAG_CONFIRMED:"tag_confirmed",FINISH:"finish",TYPE_NAME:"type_name",SELECT_NAME:"select_name",_queueName:null,sendSignal:function(a,c){new(b("AsyncSignal"))("/ajax/photos/tag_waterfall.php",{data:JSON.stringify(a)}).setHandler(c).send()}});e.exports=g}),null);
__d("PhotoTagDataSourceType",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({PRODUCT_ITEMS:"product_items",DEFAULT:"default"})}),null);
__d("PhotoTagger",["csx","ActorURI","Arbiter","AsyncRequest","AsyncResponse","CSS","DOM","DOMQuery","Event","FaceboxSourceConstants","Hovercard","Keys","LegacyMentionsInput.react","Parent","PhotosConst","PhotosTaggingWaterfall","PhotosUtils","PhotoTagDataSourceType","PhotoTagStore","QE2Logger","React","ReactDOM","Style","UFIAddCommentController","UFICentralUpdates","UFIComment.react","UFIContainer.react","URI","Vector","WWWBase","getElementPosition","removeFromArray"],(function(a,b,c,d,e,f,g){__p&&__p();function h(a,b){return(a%b+b)%b}function i(a){"use strict";this.TAG_BOX_SIZE=100,this.EPSILON=.0025,this.HUGE_FACE_THRESH=90,this.HUGE_FACE_SHRINK_FACTOR=.6,this.elemNames={6:{addTagLink:"div.fbPhotosPhotoOwnerButtons",overlayActions:"div.snowliftOverlayBar"}},this.viewer=a,this.version=a.getVersionConst(),this.datasources={},this.photoData={},this.tagRects={},this.spatialTags=[],this.isSpherical=!1,this.sphericalPhotoXY=null,this.fromSphericalFacebox=!1,this.disableSaveSpatialTag=!1,this.ajaxURIs={tagsInit:"/ajax/photos/photo/tags/tags_init.php",tagsAlbum:"/ajax/photos/photo/tags/tags_album.php",fetchDatasource:"/ajax/photos/photo/tags/fetch_datasource.php",tagAction:"/ajax/photo_tagging_ajax.php",tagWithAction:"/ajax/with_tagging_ajax.php"},this.recognizedUsers=[],this.addedSuggestions=[],this.featuredSuggestions=[],this.albumSuggestions=[],this.friendSuggestions=[],this.suggestionAlbum=-1,this.addCommentController=null,i.instances[this.version]=this}i.prototype.initSnowlift=function(a,c,d,e){"use strict";this._init(a,c,d,this.viewer.container,e),b("Arbiter").inform("PhotoSnowlift.TAGGER_READY")};i.prototype.initPermalink=function(a,b,c){"use strict";this._init(a,b,c,this.viewer.actionList)};i.prototype.initSphericalPhoto=function(a,c,d){"use strict";this._init(a,c,d,this.viewer.container),b("Arbiter").inform("PhotoTagger.SPATIAL_TAGGER_READY")};i.prototype._init=function(a,c,d,e,f){"use strict";__p&&__p();this.root=this.viewer.getRoot();this.tagger=a;this.tokenizer=c;this.ufi=f;this._qn=null;this.typeahead=c.getTypeahead();this.userId=d;this.makeProfilePicMenuContainer=e;this.faceboxes=[];this.tags=[];this.currentFacebox=null;this.currentTextbox=null;this.revokedFaceboxes=[];this.requestFaceboxNextTag=!1;this.clickState=b("DOM").find(this.root,"div.stageActions");this.newTagBox=b("DOM").find(this.clickState,"div.newTagBox");this.addTagLink=null;this.overlayActions=null;this.elemNames[this.version]&&(this.addTagLink=b("DOM").find(this.root,this.elemNames[this.version].addTagLink),this.overlayActions=b("DOM").find(this.root,this.elemNames[this.version].overlayActions));this.setupHandlers();this.hideNewTagTimer=null;this.needAlbumSuggestionsFetch=!0;this.fetchTaggingSuggestions({owner:this.photoData.owner});this.setDataSource(this.typeahead.getData());this.updateFaceboxes();this.tagAccumulating=!1;return this};i.prototype.setTagAccumulator=function(a){"use strict";this.tagAccumulating=a};i.prototype.fetchTaggingSuggestions=function(a){"use strict";__p&&__p();var c=new(b("URI"))(b("WWWBase").uri).setPath(this.ajaxURIs.tagsInit);new(b("AsyncRequest"))().setAllowCrossPageTransition(!0).setAllowCrossOrigin(!0).setURI(c).setData(a).setOption("retries",1).setHandler(function(a){a=a.getPayload();this.featuredSuggestions=a.featuredTaggees;this.friendSuggestions=a.friendTaggees;this.updateTypeaheadSuggestions()}.bind(this)).send();var d=this.typeahead.subscribe("bootstrap",function(a,b){b&&!b.bootstrapping&&(this.taggingMode&&this.updateWithSuggestions(),this.typeahead.unsubscribe(d),this.typeahead.subscribe("focus",function(){this.taggingMode&&this.updateWithSuggestions()}.bind(this)),this.typeahead.subscribe("click",function(){this.taggingMode||this.updateWithSuggestions()}.bind(this)),this.tokenizer.subscribe("removeToken",this.updateWithSuggestions.bind(this)),this.tokenizer.subscribe("addToken",this.addSuggestion.bind(this)),this.typeahead.subscribe("respond",function(a,b){this.taggingMode&&b&&!b.results.length&&this.updateWithSuggestions()}.bind(this)))}.bind(this))};i.prototype.fetchAlbumTaggingSuggestions=function(){"use strict";new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagsAlbum).setData({cachedAlbum:this.suggestionAlbum,photo:this.photoData.fbid}).setOption("retries",1).setAllowCrossPageTransition(!0).setHandler(function(a){this.needAlbumSuggestionsFetch=!1;a=a.getPayload();if(a.length===0)return;this.suggestionAlbum=a.album;this.albumSuggestions=a.taggees;this.updateTypeaheadSuggestions()}.bind(this)).send()};i.prototype.resetAlbumTaggingSuggestions=function(){"use strict";this.needAlbumSuggestionsFetch=!0,this.updateTypeaheadSuggestions()};i.prototype.updateTypeaheadSuggestions=function(){"use strict";this.typeahead.getView().setSuggestions(this.addedSuggestions.concat(this.recognizedUsers,this.featuredSuggestions,this.needAlbumSuggestionsFetch?[]:this.albumSuggestions,this.friendSuggestions))};i.prototype.saveClickPosition=function(a,c){"use strict";var d=b("Vector").getElementPosition(a);a=b("Vector").getElementDimensions(a);this.clickPercentToPhoto=new(b("Vector"))((c.x-d.x)/a.x,(c.y-d.y)/a.y)};i.prototype.getCalculatedClickPosition=function(a){"use strict";var c=b("Vector").getElementPosition(a);a=b("Vector").getElementDimensions(a);return a.x===0||a.y===0?null:new(b("Vector"))(this.clickPercentToPhoto.x*a.x+c.x,this.clickPercentToPhoto.y*a.y+c.y,"document")};i.prototype.repositionTagger=function(){"use strict";if(this.clickPercentToPhoto){var a=this.viewer.getImage();a=this.getCalculatedClickPosition(a);if(!a)return;this.addTagFromClickPos(a)}};i.prototype.setupHandlers=function(){"use strict";this.handlers=[b("Event").listen(this.clickState,"click",function(a){this.isSpherical||this.addTag(a)}.bind(this))],this.addTagLink&&this.handlers.push(b("Event").listen(this.addTagLink,"click",this.checkActions.bind(this))),this.overlayActions&&this.handlers.push(b("Event").listen(this.overlayActions,"click",this.checkActions.bind(this))),this.setupAddTagHandlers(),b("Event").listen(document.documentElement,"keydown",function(event){if(!this.taggingMode)return;var a=b("Event").getKeyCode(event);a===b("Keys").ESC?this.deactivateTagging():a===b("Keys").TAB&&this.addNextTagFromFacebox(event.shiftKey?-1:1)}.bind(this)),this.subscriptions=[b("Arbiter").subscribe(this.viewer.getEventString("PAGE"),this.restartTagging.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("DATA_CHANGE"),this.setPhotoData.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("EXTRA_DATA_CHANGE"),this.setExtraData.bind(this)),b("Arbiter").subscribe(this.viewer.getEventString("CLOSE"),this.deactivateTagging.bind(this))],b("UFICentralUpdates").subscribe("update-comments",function(a,b){b.comments&&b.comments.length&&this.commentAdded(b.comments,b.payloadsource)}.bind(this)),this.tokenizer.subscribe("addToken",this.saveTag.bind(this)),this.tokenizer.subscribe("removeToken",this.removeTag.bind(this)),this.tokenizer.subscribe("markTagAsSpam",this.markTagAsSpam.bind(this))};i.prototype.setupAddTagHandlers=function(){"use strict";if(this.ufi){var a=b("DOM").scry(this.root,".tagPhotoLink");a.forEach(function(a){b("Event").listen(a,"click",this.showTaggerFromClick.bind(this))},this)}};i.prototype.updateWithSuggestions=function(a,b){"use strict";a=this.typeahead.getData().buildUids(" ",this.typeahead.getView().getSuggestions(),this.typeahead.getCore().getExclusions());if(!a.length)return;b=this.typeahead.getData().respond("",a);for(var a=0;a<b.length;a++)b[a].index=-1e3+a};i.prototype.addSuggestion=function(a,b){"use strict";a=b.info&&b.info.uid;a&&(this.addedSuggestions.unshift(a),this.updateTypeaheadSuggestions())};i.prototype.setQueueName=function(a){"use strict";this._qn=a;return this};i.prototype._sendWaterfallLogSignal=function(a){"use strict";b("PhotosTaggingWaterfall").sendSignal({qn:this._qn,source:this.viewer.getSourceString(),step:a,pid:this.photoData.pid})};i.prototype._sendFaceboxSuggestionLogSignal=function(a,c,d){"use strict";b("PhotosTaggingWaterfall").sendSignal({step:b("PhotosTaggingWaterfall").SHOW_SUGGEST,photo_owner:this.photoData.owner,tagee:a,is_first:!0,source:c,photo_id:this.photoData.fbid,facebox_id:d})};i.prototype._bumpQueueName=function(){"use strict";this._qn&&(this._qn+=1)};i.prototype.activateTagging=function(){"use strict";b("Arbiter").inform("PhotoTagger.ACTIVATE_TAGGING"),this.getDataSource()?this.dataSourceFetched(this.getDataSource()):new(b("AsyncRequest"))(this.ajaxURIs.fetchDatasource).setData({fbid:this.photoData.fbid,version:this.version,data_source_type:this.dataSourceType}).send(),this.needAlbumSuggestionsFetch&&this.fetchAlbumTaggingSuggestions()};i.prototype.restartTagging=function(){"use strict";this.hideNewTag(),this.hideTagger(),this.hideExistingTags(),this.revokedFaceboxes=[],this.setCurrentFacebox(null),this.taggingMode&&(this.requestFaceboxNextTag=!0,this.activateTagging())};i.prototype.getDataSource=function(){"use strict";return this.datasources[this.getDataSourceKey()]};i.prototype.getDataSourceKey=function(){"use strict";var a;this.photoData.ownertype=="user"&&!this.photoData.obj_id?a="friends":a=this.photoData.obj_id||this.photoData.owner;return this.dataSourceType===b("PhotoTagDataSourceType").PRODUCT_ITEMS?a+"_products":a};i.prototype.setDataSource=function(a){"use strict";this.typeahead.getData()!=a&&this.typeahead.swapData(a),this.datasources[this.getDataSourceKey()]=a};i.prototype.dataSourceFetched=function(a){"use strict";__p&&__p();b("CSS").removeClass(this.root,"productTagging");b("CSS").removeClass(this.root,"peopleTagging");var c=this.dataSourceType===b("PhotoTagDataSourceType").DEFAULT;this.taggingMode=!0;b("CSS").addClass(this.root,"taggingMode");b("CSS").addClass(this.root,c?"peopleTagging":"productTagging");this._hidePivots();b("Arbiter").inform("PhotoTagger.START_TAGGING");this._bumpQueueName();this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").BEGIN);this.setDataSource(a)};i.prototype.deactivateTagging=function(){"use strict";this.taggingMode===!0&&this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").FINISH),this.taggingMode=!1,this.hideNewTag(),this.hideTagger(),this.hideExistingTags(),this.setCurrentFacebox(null),this._showPivots(),b("CSS").removeClass(this.root,"taggingMode"),this.dataSourceType===b("PhotoTagDataSourceType").PRODUCT_ITEMS?b("CSS").removeClass(this.root,"productTagging"):b("CSS").removeClass(this.root,"peopleTagging"),b("Arbiter").inform("PhotoTagger.STOP_TAGGING")};i.prototype._hidePivots=function(){"use strict";var a=b("DOMQuery").scry(this.root,".tag");for(var c=0;c<a.length;c++)b("CSS").hide(a[c])};i.prototype._showPivots=function(){"use strict";var a=b("DOMQuery").scry(this.root,".tag");for(var c=0;c<a.length;c++)b("CSS").show(a[c])};i.prototype.checkActions=function(event){"use strict";var a=event.getTarget(),c=b("Parent").byClass(a,"fbPhotosPhotoActionsTag");a=b("Parent").byClass(a,"fbPhotosPhotoActionsProductTag");if(c||a){var d=b("CSS").hasClass(this.root,"peopleTagging"),e=b("CSS").hasClass(this.root,"productTagging");c=c&&e||a&&d;this.taggingMode&&!c?this.deactivateTagging():(this.dataSourceType=a?b("PhotoTagDataSourceType").PRODUCT_ITEMS:b("PhotoTagDataSourceType").DEFAULT,this.activateTagging(),this.isSpherical||this.addNextTagFromFacebox(1))}};i.prototype.hideTagger=function(){"use strict";b("CSS").hide(this.tagger);this.clickPercentToPhoto=null;var a=b("DOM").scry(this.tagger,"input.textInput")[0];a&&a.blur()};i.prototype.showTaggerFromClick=function(event){"use strict";__p&&__p();var a=event.getTarget();a=b("Parent").byClass(a,"tagPhotoLink");var c=a.getAttribute("data-x");a=a.getAttribute("data-y");if(c!==null&&a!==null){c=new(b("Vector"))(c,a);a=this.viewer.getImage();c=b("PhotosUtils").normalizedToAbsolutePosition(a,c);this.setClickPosAndFacebox(c);this.addTagFromClickPos(c)}this.showTagger()};i.prototype.showTagger=function(){"use strict";__p&&__p();b("QE2Logger").logExposureForUser("www_snowlift_photo_tagger_qe");b("DOM").scry(this.root,".fbPhotosPhotoTagboxBase").forEach(function(a){b("CSS").removeClass(a,"hover"),b("CSS").removeClass(a,"tagClick"),this.taggingMode&&b("CSS").hide(b("DOM").find(a,".tag"))},this);var a=b("DOM").find(this.tagger,".typeaheadContainer"),c=b("DOM").find(a,".arrow .nub"),d=3;b("Style").set(a,"margin-left",0);b("Style").set(c,"margin-left",0);var e=b("getElementPosition")(a);e.x<=0&&(b("CSS").hasClass(this.tagger,"fbPhotoTaggerFlipped")||(b("Style").set(a,"margin-left",-2*e.x+"px"),b("Style").set(c,"margin-left",e.x-d+"px")));if(this.ufi){c=b("DOM").find(this.tagger,"._12nb");b("CSS").show(a);b("CSS").hide(c)}b("CSS").show(this.tagger);setTimeout(function(){b("DOM").find(this.tagger,"input.textInput").focus()}.bind(this),0);this.hideNewTag();b("Arbiter").inform("reflow")};i.prototype.showNewTag=function(a,c){"use strict";__p&&__p();if(c&&this.ufi){b("CSS").addClass(c,"hover");b("DOM").find(c,".uiLinkButtonInput").value=a;return}if(!this.newTagBox)return;b("DOM").setContent(b("DOM").find(this.newTagBox,"div.tagName"),b("DOM").create("span",null,a));b("CSS").show(this.newTagBox);this.hideNewTagTimer=setTimeout(this.hideNewTag.bind(this),3e3)};i.prototype.hideNewTag=function(){"use strict";if(!this.newTagBox)return;this.hideNewTagTimer!==null&&(clearTimeout(this.hideNewTagTimer),this.hideNewTagTimer=null);b("CSS").hide(this.newTagBox)};i.prototype.getTaggerPositioningOrigin=function(){"use strict";return b("Vector").getElementPosition(this.clickState,"document")};i.prototype.setClickPosAndFacebox=function(a){"use strict";var c=this.viewer.getImage();this.saveClickPosition(c,a);c=b("PhotosUtils").absoluteToNormalizedPosition(c,a);this.setCurrentFacebox(this.findNearestFacebox(c))};i.prototype.addTagFromClickPos=function(a){"use strict";__p&&__p();this.currentTextbox=null;this.hideExistingTags();if(this.currentFacebox)this.addTagFromFaceboxDontSave(this.currentFacebox);else{var c=this.viewer.getImage(),d=b("PhotosUtils").absoluteToNormalizedPosition(c,a);if(this.tags!==undefined)for(var e=0;e<this.tags.length;e++)this.tags[e].rect.contains(d)&&(this.showExistingTag(this.tags[e]),this.currentTextbox=this.tags[e]);this.removeSuggestionFromTagger();b("CSS").removeClass(b("DOM").find(this.tagger,".faceBox"),"faceBoxHidden");if(this.currentTextbox){e=this.currentTextbox.rect.w()/100*b("Vector").getElementDimensions(c).x;this.addTagFromPosition(a,e)}else this.addTagFromPosition(a,this.TAG_BOX_SIZE)}};i.prototype.showExistingTag=function(a){"use strict";this.taggingMode?(this._hidePivots(),b("CSS").show(b("DOM").find(a.node,".tag")),b("CSS").addClass(a.node,"tagClick")):b("CSS").addClass(a.node,"hover"),this.hideTagger()};i.prototype.hideExistingTags=function(){"use strict";var a=b("DOM").scry(this.root,".tagClick");a&&a.forEach(function(a){b("CSS").removeClass(a,"tagClick"),this.taggingMode&&b("CSS").hide(b("DOM").find(a,".tag"))}.bind(this))};i.prototype.addTag=function(event){"use strict";var a=event.getTarget(),c=b("Parent").byClass(a,"fbPhotosPhotoButtons");if(!this.taggingMode||c&&a!==c||b("Parent").byClass(a,"fbPhotosPhotoActions")||b("Parent").byClass(a,"faceboxSuggestion")||b("Parent").byClass(a,"photoTagTypeahead")||b("Parent").byClass(a,"tagUfi"))return;c=b("Vector").getEventPosition(event);this.setClickPosAndFacebox(c);this.addTagFromClickPos(c)};i.prototype.addSpatialTag=function(a,event){"use strict";__p&&__p();var c=event.getTarget(),d=b("Parent").byClass(c,"fbPhotosPhotoButtons"),e=a.inTaggingMode?this.viewer.stageActions:this.viewer.stage;if(d&&c!==d||b("Parent").byClass(c,"fbPhotosPhotoActions")||b("Parent").byClass(c,"faceboxSuggestion")||b("Parent").byClass(c,"photoTagTypeahead")||b("Parent").byClass(c,"tagUfi")||!a.screenPos||!a.photoXY||!a.size||!this.isSpherical||!e)return;this.sphericalPhotoXY=a.photoXY;this.fromSphericalFacebox=a.fromTag;d=b("getElementPosition")(e);this.fromSphericalFacebox&&!!a.suggestion?this.addTagFromFaceboxDontSave(a.suggestion):this.removeSuggestionFromTagger();this.addTagFromPosition(b("Vector").from(a.screenPos.x+d.x,a.screenPos.y+d.y,"document"),a.size);c=b("DOM").find(this.tagger,".faceBox");this.fromSphericalFacebox&&!b("CSS").hasClass(c,"faceBoxHidden")&&b("CSS").addClass(c,"faceBoxHidden");!this.fromSphericalFacebox&&b("CSS").hasClass(c,"faceBoxHidden")&&b("CSS").removeClass(c,"faceBoxHidden")};i.prototype.showTagIfCommentAdded=function(){"use strict";__p&&__p();if(this.taggingMode){var a=this.getClickPointForSave(),c=b("Vector").from(a.x,a.y);if(a!==null)for(var a=0;a<this.tags.length;a++)if(this.tags[a].rect.contains(c)){this.showExistingTag(this.tags[a]);this.hideTagger();return}}};i.prototype.commentAdded=function(a,c){"use strict";__p&&__p();a.forEach(function(a){__p&&__p();var c=this.getClickPointForSave(),d=null;if(a.isPhotoTag&&(a.photoTextTagID===null||a.photoTextTagID===undefined)&&a.photoTagX!==null&&a.photoTagY!==null)if(c!==null&&a.photoTagX===c.x&&a.photoTagY===c.y)d=b("DOM").find(this.tagger,"._12nb");else{c=new(b("Vector"))(a.photoTagX,a.photoTagY);c=this.findNearestTag(c);c!==null&&(d=b("DOM").find(c.node,"._12nb"))}if(d!==null){c=b("DOM").find(d,".UFIContainer");var e={};e[a.author]={id:a.author};b("ReactDOM").render(b("React").createElement(b("UFIContainer.react"),null,b("React").createElement(b("UFIComment.react"),{comment:a,authorProfiles:e,feedback:{},contextArgs:{}})),c);b("Style").set(b("DOM").find(d,".UFIAddComment"),"opacity",.5);b("DOM").find(d,"textarea").setAttribute("disabled","disabled")}},this)};i.prototype.showTaggerUFI=function(event){"use strict";__p&&__p();var a=b("DOM").find(this.tagger,".typeaheadContainer"),c=b("DOM").find(this.tagger,"._12nb"),d=b("DOM").find(c,".arrow .nub"),e=3,f=b("getElementPosition")(c);f.x<=0&&!b("CSS").hasClass(this.tagger,"fbPhotoTaggerFlipped")?(b("Style").set(c,"margin-left",-2*f.x+"px"),b("Style").set(d,"margin-left",f.x-e+"px")):(b("Style").set(c,"margin-left",0),b("Style").set(d,"margin-left",0));f=this.getClickPointForSave();e=b("DOM").find(c,".tagUfiAddComment");d=b("DOM").find(this.viewer.ufiInputContainer,'input[name="ft_ent_identifier"]');d={ftentidentifier:d.value,source:e.getAttribute("data-source"),mentionsinput:{inputComponent:b("LegacyMentionsInput.react")},hideActorPhoto:!0,isPhotoTag:!0,photoFBID:this.viewer.getCurrentPhotoInfo().fbid,photoTagX:f.x,photoTagY:f.y};this.addCommentController=b("UFIAddCommentController").factory(e,d);f=b("DOM").find(c,".UFIContainer");f.firstChild!==null&&b("DOM").remove(f.firstChild);b("Style").set(b("DOM").find(c,".UFIAddComment"),"opacity",1);b("DOM").find(c,"textarea").removeAttribute("disabled");b("CSS").show(this.tagger);b("CSS").hide(a);b("CSS").show(c);b("Arbiter").inform("reflow")};i.prototype._findNearest=function(a,b){"use strict";var c=Infinity,d=null;a.forEach(function(a){if(a.rect.contains(b)){var e=b.distanceTo(a.rect.getCenter());e<c&&(c=e,d=a)}});return d};i.prototype.findNearestFacebox=function(a){"use strict";return this._findNearest(this.faceboxes,a)};i.prototype.findNearestTag=function(a){"use strict";return this._findNearest(this.tags,a)};i.prototype.addNextTagFromFacebox=function(a){"use strict";__p&&__p();if(this.faceboxes.length===0)return;if(!this.currentFacebox)this.setCurrentFacebox(this.faceboxes[0]);else{var b=this.faceboxes.indexOf(this.currentFacebox);a=h(b+a,this.faceboxes.length);if(a===b)return;this.setCurrentFacebox(this.faceboxes[a])}this.addTagFromFacebox(this.currentFacebox)};i.prototype.addTagFromFaceboxDontSave=function(a){"use strict";__p&&__p();b("CSS").addClass(a.node,"active");b("CSS").addClass(b("DOM").find(this.tagger,".faceBox"),"faceBoxHidden");var c=a.rect.getCenter(),d=this.viewer.getImage();c=b("PhotosUtils").normalizedToAbsolutePosition(d,c);d=a.rect.w()/100*b("Vector").getElementDimensions(d).x;a.rect.w()>this.HUGE_FACE_THRESH&&a.rect.h()>this.HUGE_FACE_THRESH&&(d*=this.HUGE_FACE_SHRINK_FACTOR);var e=this.getFaceboxSuggestionFromFaceboxElem(a.node);if(e){var f=this.version===b("PhotosConst").VIEWER_PERMALINK?b("FaceboxSourceConstants").PERMALINK_DISMISS:b("FaceboxSourceConstants").SNOWLIFT_DISMISS;this.addSuggestionToTagger(a,e);this._sendFaceboxSuggestionLogSignal(e.getAttribute("data-id"),f,a.id)}else this.removeSuggestionFromTagger();this.isSpherical||this.addTagFromPosition(c,d);return c};i.prototype.getFaceboxSuggestionFromFaceboxElem=function(a){"use strict";return b("DOM").scry(a,"._570u")[0]};i.prototype.addSuggestionToTagger=function(a,c){"use strict";this.removeSuggestionFromTagger();b("CSS").addClass(this.tagger,"suggestionActive");var d=b("DOM").find(this.tagger,".typeaheadContainer");c=c.cloneNode(!0);this.stripReactID(c);b("DOM").appendContent(d,c);this.setupFaceboxSuggestionHandlers(a,c)};i.prototype.stripReactID=function(a){"use strict";a.removeAttribute("data-reactid");for(var b=0;b<a.children.length;b++)this.stripReactID(a.children[b])};i.prototype.removeSuggestionFromTagger=function(){"use strict";b("CSS").removeClass(this.tagger,"suggestionActive");var a=b("DOM").scry(this.tagger,".faceboxSuggestion");a&&a.forEach(function(a){b("DOM").remove(a)})};i.prototype.dismissFaceboxSuggestion=function(a,c,d,e){"use strict";new(b("AsyncRequest"))().setURI("/ajax/dismiss_tag_suggest.php").setMethod("POST").setData({facebox_logs:[{facebox:a,log_data:{photo_owner:d,tagee:c,is_first:!0}}],closing_source:e,closing_action:"no"}).setAllowCrossPageTransition(!0).send()};i.prototype.addTagFromFacebox=function(a){"use strict";this.currentTextbox=null;a=this.addTagFromFaceboxDontSave(a);var b=this.viewer.getImage();this.saveClickPosition(b,a)};i.prototype.addTagFromPosition=function(a,c){"use strict";__p&&__p();var d=this.viewer.getImage(),e=this.calcTaggerPosition(d,a,c);this.calcClickPoint(d,a);if(!e){this.hideTagger();return}e.setElementPosition(this.tagger);this.newTagBox&&(e.setElementPosition(this.newTagBox),new(b("Vector"))(c,c).setElementDimensions(this.newTagBox));e=b("Vector").getElementPosition(d);c=b("Vector").getElementDimensions(d);d=this.typeahead.getView();a.y>e.y+c.y*3/4?(b("CSS").addClass(this.tagger,"fbPhotoTaggerFlipped"),d.addTypeaheadFlip("fbPhotoTaggerFlipped"),a.x>e.x+c.x*1/2?this.flipRules("fbPhotoTaggerRight","fbPhotoTaggerLeft",d):this.flipRules("fbPhotoTaggerLeft","fbPhotoTaggerRight",d)):(b("CSS").removeClass(this.tagger,"fbPhotoTaggerFlipped"),b("CSS").removeClass(this.tagger,"fbPhotoTaggerLeft"),b("CSS").removeClass(this.tagger,"fbPhotoTaggerRight"),d.removeTypeaheadFlip("fbPhotoTaggerFlipped"),d.removeTypeaheadFlip("fbPhotoTaggerLeft"),d.removeTypeaheadFlip("fbPhotoTaggerRight"));(!this.taggingMode||this.currentTextbox===null)&&this.ufi&&this.currentFacebox===null?this.showTaggerUFI():this.showTagger();this.taggingMode?this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").TAG_FACE):this._sendWaterfallLogSignal(b("PhotosTaggingWaterfall").HOVER_TAG_FACE)};i.prototype.flipRules=function(a,c,d){"use strict";b("CSS").addClass(this.tagger,a),b("CSS").removeClass(this.tagger,c),d.addTypeaheadFlip(a),d.removeTypeaheadFlip(c)};i.prototype.calcTaggerPosition=function(a,c,d,e){"use strict";__p&&__p();e=e||d;var f=b("Vector").getElementPosition(a);a=b("Vector").getElementDimensions(a);var g=new(b("Vector"))(d/2,e/2),h=c.sub(f);for(var i in{x:1,y:1}){if(c[i]<f[i]||c[i]>f[i]+a[i])return null;var j=i==="x"?d:e;h[i]<j/2?g[i]=h[i]:a[i]<h[i]+j/2&&(g[i]=j-(a[i]-h[i]))}j=3;a=b("DOM").find(this.tagger,".faceBox");f=Math.max(0,d-j*2);h=Math.max(0,e-j*2);b("Style").set(a,"width",f+"px");b("Style").set(a,"height",h+"px");d=c.sub(this.getTaggerPositioningOrigin());return d.sub(g.x,g.y)};i.prototype.calcClickPoint=function(a,c){"use strict";var d=b("Vector").getElementDimensions(a);a=b("Vector").getElementPosition(a);c=c.sub(a);!this.isSpherical?this.clickPoint={x:c.x/d.x,y:c.y/d.y}:this.clickPoint={x:this.sphericalPhotoXY.x,y:this.sphericalPhotoXY.y}};i.prototype.getClickPointForSave=function(){"use strict";return this.clickPoint===undefined?null:{x:this.clickPoint.x*100,y:this.clickPoint.y*100}};i.prototype.getTaggingDataForSave=function(a,b){"use strict";a=this.getTaggingData("add",a.isFreeform()?"":a.getValue(),a.getText(),b);b=this.getClickPointForSave();a.x=b.x;a.y=b.y;a.from_facebox=this.isSpherical?this.fromSphericalFacebox:!!this.currentFacebox;a.tagging_mode=!!this.taggingMode;return a};i.prototype.saveTag=function(a,c,d){"use strict";__p&&__p();if(this.disableSaveSpatialTag&&this.isSpherical&&this.tagAccumulating)return;a=this.getTaggingDataForSave(c,d);if(this.tagAccumulating)this.isSpherical?b("Arbiter").inform("PhotoTagger.SAVE_SPATIAL_TAG",a):b("PhotoTagStore").getInstance().storeTagWithOptions(this.photoData.fbid,a.subject,a.x,a.y,a);else{this.isSpherical&&b("Arbiter").inform("PhotoTagger.SAVE_SPATIAL_TAG");d=b("ActorURI").create(this.ajaxURIs.tagAction,this.photoData.owner);new(b("AsyncRequest"))().setURI(d).setMethod("POST").setData(a).setAllowCrossPageTransition(!0).setHandler(this.tagsChangeHandler.bind(this)).setErrorHandler(this.checkError.bind(this,c)).send()}d=this.userId===a.subject;if(d&&!this.isSpherical){var e=b("DOM").scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(e.length===1){e=e[0];b("CSS").removeClass(e,"hide")}}if(!this.isSpherical){e=new(b("Vector"))(a.x,a.y);var f=this.findNearestTag(e);f&&f.rect.contains(e)?this.showNewTag(c.getText(),f.node):this.showNewTag(c.getText())}this.hideTagger();if(!this.isSpherical){e=this.currentFacebox;e&&(this.taggingMode&&this.addNextTagFromFacebox(1),this.removeFacebox(e))}b("Arbiter").inform("PhotoTagger.ADDING_TAG",{subject:a.subject,text:c.getText()});b("Arbiter").inform("PhotoTagger.SAVE_TAG",{photo_fbid:this.photoData.fbid,self_tag:d})};i.prototype.getTaggingData=function(a,b,c,d){"use strict";return{cs_ver:this.version,pid:this.photoData.pid,fbid:this.photoData.fbid,id:this.photoData.owner,subject:b,name:c,action:a,source:d?d:this.viewer.getSourceString(),qn:this._qn,position:this.getPosition(),slsource:this.viewer.getViewerSource(),slset:this.viewer.getViewerSet()}};i.prototype.getPosition=function(){"use strict";return this.viewer.getPosition()};i.prototype.tagsChangeHandler=function(a){"use strict"};i.prototype.checkError=function(a,c){"use strict";c.getPayload()&&c.getPayload().clear_tag&&(a.already_untagged=!0,this.tokenizer.removeToken(a)),b("AsyncResponse").defaultErrorHandler(c)};i.prototype.removeTag=function(a,c,d){"use strict";__p&&__p();if(c.already_untagged||this.tagAccumulating&&this.isSpherical)return;a="remove";b("DOM").scry(c.element,"a.pending")[0]&&(a="retract");c.blockUser&&(a="remove_block");this.tagAccumulating?c.isFreeform()?b("PhotoTagStore").getInstance().removeTextTag(this.photoData.fbid,c.getInfo().text):b("PhotoTagStore").getInstance().removeTag(this.photoData.fbid,c.getInfo().uid):new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagAction).setMethod("POST").setData(this.getTaggingData(a,c.isFreeform()?"":c.getInfo().uid,c.getInfo().text)).setHandler(function(a){this.tagsChangeHandler(a),d&&d()}.bind(this)).setAllowCrossPageTransition(!0).send();if(this.userId===parseInt(c.getValue(),10)&&this.userId!==this.viewer.getCurrentPhotoInfo().owner){a=b("DOM").scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(a.length===1){c=a[0];b("CSS").addClass(c,"hide")}b("Arbiter").inform("PhotoTagger.REMOVED_MAKE_PROFILE_PIC_OPTION")}};i.prototype.removeTagByID=function(a,b,c){"use strict";a=this.tokenizer.tokens;for(var d=0;d<a.length;d++)if(a[d].info.uid==b)return this.removeTag(null,a[d],c);return null};i.prototype.removeTagByIDFromHovercardLink=function(a,c,d){"use strict";this.removeTagByID(a,c,function(){b("Hovercard").contains(d)&&b("Hovercard").hide(!0)})};i.prototype.removeWithTag=function(a,c){"use strict";new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagWithAction).setMethod("POST").setData({action:"remove_with",taggee:c,tag:a,version:this.version,fbid:this.photoData.fbid}).setHandler(function(a){this.tagsChangeHandler(a),b("Hovercard").hide(!0)}.bind(this)).setAllowCrossPageTransition(!0).send()};i.prototype.setPhotoData=function(a,b){"use strict";this.clickPercentToPhoto=null;this.photoData=b;this.isSpherical=b.isSpherical;return this};i.prototype.setExtraData=function(a,b){"use strict";this.tagRects=b.tagRects;b.spatialTags&&(this.spatialTags=b.spatialTags);this.updateFaceboxes();this.setupAddTagHandlers();this._setInitialFaceboxFromID(b);b.openTag&&setTimeout(function(){this.activateTagging(),this._setInitialFaceboxFromID(b),this.faceboxes.length===1?this.addTagFromFacebox(this.currentFacebox):this.addNextTagFromFacebox(1)}.bind(this),0);return this};i.prototype._setInitialFaceboxFromID=function(a){"use strict";if(a.initialFaceboxID!==null&&this.faceboxes.length!==0){a=this.getFacebox(a.initialFaceboxID);if(a!==null){a=this.faceboxes.indexOf(a);a=h(a-1,this.faceboxes.length);this.setCurrentFacebox(this.faceboxes[a])}}};i.prototype.markTagAsSpam=function(a,c){"use strict";new(b("AsyncRequest"))().setURI(this.ajaxURIs.tagAction).setMethod("POST").setData(this.getTaggingData("mark_as_spam",c,null)).send()};i.prototype.removeFacebox=function(a){"use strict";if(a===null)return;this.revokedFaceboxes.push(a.rect.getCenter());b("removeFromArray")(this.faceboxes,a);b("DOM").remove(a.node);a===this.currentFacebox&&this.setCurrentFacebox(null)};i.prototype.setCurrentFacebox=function(a){"use strict";this.currentFacebox&&b("CSS").removeClass(this.currentFacebox.node,"active"),this.currentFacebox=a,a&&(this.recognizedUsers=JSON.parse(a.node.getAttribute("data-recognizeduids")),this.updateTypeaheadSuggestions())};i.prototype.updateRevokedFaceboxes=function(){"use strict";__p&&__p();this.revokedFaceboxes=this.revokedFaceboxes.filter(function(a){for(var b=0;b<this.faceboxes.length;++b){var c=this.faceboxes[b];c=a.distanceTo(c.rect.getCenter());if(c<this.EPSILON)return!0}return!1}.bind(this)),this.revokedFaceboxes.forEach(function(a){a=this.findNearestFacebox(a);b("removeFromArray")(this.faceboxes,a);b("DOM").remove(a.node)}.bind(this))};i.prototype.updateFaceboxes=function(){"use strict";__p&&__p();this.faceboxes=[];this.tags=[];for(var a in this.tagRects){var c;b("PhotosUtils").isFacebox(a)?c=this.faceboxes:b("PhotosUtils").isTag(a)&&(c=this.tags);if(c){var d="container";this.version===b("PhotosConst").VIEWER_PERMALINK&&(d="root");d=b("DOM").scry(this.viewer[d],"#"+a);d.length>0&&c.push({node:d[0],id:a,rect:this.tagRects[a]})}this.showTagIfCommentAdded()}this.updateRevokedFaceboxes();this.faceboxes.sort(function(a,b){return a.rect.getCenter().x-b.rect.getCenter().x});if(this.currentFacebox){d=this.currentFacebox.rect.getCenter();this.setCurrentFacebox(this.findNearestFacebox(d));b("CSS").addClass(this.currentFacebox.node,"active")}this.requestFaceboxNextTag&&(this.addNextTagFromFacebox(1),this.requestFaceboxNextTag=!1)};i.prototype.getFacebox=function(a){"use strict";for(var b=0;b<this.faceboxes.length;++b)if(this.faceboxes[b].id===a)return this.faceboxes[b];return null};i.prototype.setupFaceboxSuggestionHandlers=function(a,c){"use strict";__p&&__p();var d=b("DOM").find(c,"a._570w"),e=b("DOM").find(c,"a._570x");this.handlers.push(b("Event").listen(d,"click",function(d){d=this._getCurrentFaceboxID();var e=this.version===b("PhotosConst").VIEWER_PERMALINK?b("FaceboxSourceConstants").PERMALINK_DISMISS:b("FaceboxSourceConstants").SNOWLIFT_DISMISS;this.dismissFaceboxSuggestion(a.id.replace("face:",""),c.getAttribute("data-id"),this.photoData.owner,e);this.removeSuggestionFromTagger();this.hideTagger();b("DOM").remove(this.getFaceboxSuggestionFromFaceboxElem(a.node));b("Arbiter").inform("PhotoTagger.TAG_SUGGESTION_REJECTED/"+d)}.bind(this)),b("Event").listen(e,"click",function(a){a=this._getCurrentFaceboxID();var d={uid:c.getAttribute("data-id"),text:c.getAttribute("data-text")};d=this.tokenizer.createToken(d);var e=this.version===b("PhotosConst").VIEWER_PERMALINK?b("FaceboxSourceConstants").PERMALINK_SUGGEST:b("FaceboxSourceConstants").SNOWLIFT_SUGGEST;this.saveTag(null,d,e);b("Arbiter").inform("PhotoTagger.TAG_SUGGESTION_CONFIRMED/"+a)}.bind(this)))};i.prototype._getCurrentFaceboxID=function(){"use strict";return this.currentFacebox&&this.currentFacebox.id.substring(5)};i.getInstance=function(a){"use strict";return i.instances[a]};i.resetAlbumTaggingSuggestions=function(a){"use strict";a=i.getInstance(a);a&&a.resetAlbumTaggingSuggestions()};Object.assign(i,{instances:{}});e.exports=i}),null);
__d("TagTypeaheadView",["AsyncRequest","ContextualTypeaheadView","CSS","DOM","FamilyTaggingConfig","Parent"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("ContextualTypeaheadView"));g=c&&c.prototype;function a(a,b){"use strict";g.constructor.call(this,a,b),this.hintText=b.hintText,this.userEd=b.userEd,this.origAutoSelect=b.autoSelect,this.setSuggestions(b.suggestions)}a.prototype.init=function(){"use strict";b("CSS").addClass(this.element,"uiTagTypeaheadView"),g.init.call(this)};a.prototype.buildResults=function(a){"use strict";__p&&__p();!this.value&&this.hintText&&a.unshift({subtext:this.hintText,type:"hintText"});this.userEd&&(new(b("AsyncRequest"))().setURI("/ajax/fof/user_education.php").setData({increment:1}).send(),a.unshift({subtext:this.userEd,type:"userEdText"}));if(b("FamilyTaggingConfig").gk){var c=[],d=[];for(var e=0;e<a.length;e++)a[e].type!=="family_tags"&&a[e].index!=-1e3&&a[e].type!=="hintText"?c.push(a[e]):d.push(a[e]);a=d.concat(c);g.updateResults.call(this,a)}e=g.buildResults.call(this,a);this.userEd&&a.shift();this.value||a.shift();return e};a.prototype.show=function(){"use strict";var a=b("DOM").scry(this.context,".typeaheadBackdrop");a.length>0&&b("CSS").addClass(a[0],"resultsPresent");return g.show.call(this)};a.prototype.hide=function(){"use strict";var a=b("DOM").scry(this.context,".typeaheadBackdrop");a.length>0&&b("CSS").removeClass(a[0],"resultsPresent");return g.hide.call(this)};a.prototype.render=function(a,b,c){"use strict";this.autoSelect=this.origAutoSelect&&a.length,this.disableAutoSelect=a.length===0,b=b.concat(this.getAdditionalResults()),g.render.call(this,a,b,c)};a.prototype.getItems=function(){"use strict";var a=g.getItems.call(this);this.value||a.shift();this.userEd&&a.shift();return a};a.prototype.getSuggestions=function(){"use strict";return this.suggestions};a.prototype.setSuggestions=function(a){"use strict";this.suggestions=a?a.map(String):[],this.visible=!!this.suggestions.length};a.prototype.addSuggestion=function(a){"use strict";this.suggestions.unshift(a)};a.prototype.addTypeaheadFlip=function(a){"use strict";b("CSS").addClass(this.element,a)};a.prototype.removeTypeaheadFlip=function(a){"use strict";b("CSS").removeClass(this.element,a)};a.prototype.getContext=function(){"use strict";var a=b("Parent").byClass(this.element,"typeaheadContainer");if(a)return a;else return g.getContext.call(this)};a.prototype.getAdditionalResults=function(){"use strict";return[]};e.exports=a}),null);
__d("legacy:ShowResultsOnFocusTypeaheadBehavior",["TypeaheadShowResultsOnFocus"],(function(a,b,c,d,e,f){a.TypeaheadBehaviors||(a.TypeaheadBehaviors={}),a.TypeaheadBehaviors.showResultsOnFocus=function(a){a.enableBehavior(b("TypeaheadShowResultsOnFocus"))}}),3);