if (self.CavalryLogger) { CavalryLogger.start_js(["f4fE2"]); }

__d("NotificationJewelController",["Arbiter","Bootloader","Event","EventProfiler","FunnelLogger","NotificationConstants","NotificationCounter","NotificationJewelFunnelLoggingConstants","NotificationListConfig","NotificationSeenState","NotificationStore","NotificationUpdates","XWorkHubController","clearTimeout","createObjectFrom","curry","gkx","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){__p&&__p();var g=b("NotificationConstants").PayloadSourceType,h=b("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_EVENT,i=b("NotificationJewelFunnelLoggingConstants").FUNNEL_LOGGING_NAME,j=0,k=!1,l=!1,m=null;function n(a){var c=b("NotificationSeenState").getUnseenCount();b("Arbiter").inform("jewel/count-updated",{jewel:a,count:c,animation:k&&c>0?"heart":"none"},"state")}function a(a,c){"use strict";__p&&__p();var d=c.badgeAnimationData,e=c.endPoint,f=c.list;c.startTime;c=c.unseenNotifs;e&&b("NotificationStore").registerEndpoint({endpointControllerName:e});b("NotificationCounter").init();var l=b("Event").listen(a.getRoot(),"mouseover",function(){b("FunnelLogger").startFunnel(i),l&&l.remove(),l=null,b("FunnelLogger").appendAction(i,h.MOUSE_OVER_ON_JEWEL),this.eagerRender(f)}.bind(this));b("NotificationListConfig").eagerRenderJewel&&this.eagerRender(f);var o=null;b("Event").listen(a.getRoot(),"mouseover",function(){o=b("setTimeoutAcrossTransitions")(function(){b("Bootloader").loadModules(["QE2Logger"],function(a){a.logExposureForUser("www_jewel_tooltip_experiment")},"NotificationJewelController"),o=null},500)});b("Event").listen(a.getRoot(),"mouseout",function(){o&&b("clearTimeout")(o)});b("gkx")("AT7qvBGeY3qi4kzGsfSdDBRKoyiGhUCE2HY_OLm4gW_hIR5XTy870z-6Bh0Vp_U80-c")&&b("Event").listen(a.getButton(),"click",function(a){if(a.metaKey||a.ctrlKey){a=b("XWorkHubController").getURIBuilder().setString("ref","jewel").setString("tab","all").getURI();window.open(a,"notification_hub_tab_identifier")}});var p=!1,q=a.subscribe("opened",function(){p||(p=!0,b("EventProfiler").tagCurrentActiveInteractionsAs("FirstNotificationJewelOpen")),m&&m(),q&&q.unsubscribe(),q=null,f.open()}),r=f.pause.bind(f);a.subscribe("opened",function(){setTimeout(r,0),n(a.name),b("Bootloader").loadModules(["NotificationVPVs"],function(a){return a.clearImpressions()},"NotificationJewelController"),b("Arbiter").inform("notificationJewel/opened")});a.subscribe("closed",function(){f.unpause(),n(a.name),b("Arbiter").inform("notificationJewel/closed"),f.setFlyoutOpenState(!1)});a.subscribe("user-open",function(event,a){f.setFlyoutOpenState(!0)});a.isOpen()&&f.setFlyoutOpenState(!0);(b("NotificationListConfig").eagerOnBadgeUpdate||b("NotificationListConfig").eagerOnBadgeIncreaseFromZero&&a.initialCount===0)&&a.subscribe("updated",function(b,c){c&&c.count>a.initialCount&&this.eagerRender(f)}.bind(this));b("NotificationUpdates").subscribe("seen-state-updated",b("curry")(n,a.name));d&&(d.logWithQEUniverse&&b("Bootloader").loadModules(["QE2Logger"],function(a){return a.logExposureForUser(d.logWithQEUniverse)},"NotificationJewelController"),d.injectWithAnimation&&b("Bootloader").loadModules(["RelationshipDelightsBadge"],function(b){return b.inject(a,d.injectWithAnimation)},"NotificationJewelController"),b("Bootloader").loadModules(["RelationshipDelightUtils"],function(a){b("NotificationUpdates").subscribe("update-notifications",function(b,c){b=c.nodes;c=c.payloadsource;b=b&&b.length?b.filter(a.shouldHeartBadge):null;b&&b.length?(k=!0,d.injectWithAnimation&&((c===g.INITIAL_LOAD||c===g.INITIAL_SEND)&&a.logBadgeAnimation(b[0].alert_id))):k=!1}),d.logWithAlertID&&a.logBadgeAnimation(d.logWithAlertID)},"NotificationJewelController"));b("NotificationUpdates").handleUpdate(g.INITIAL_LOAD,{seenState:b("createObjectFrom")(c,j)});n(a.name)}a.prototype.eagerRender=function(a){"use strict";l||(l=!0,m=b("EventProfiler").notifyRunningEagerInteraction(["Notifications_Jewel_Button"],"click"),a.open())};e.exports=a}),null);