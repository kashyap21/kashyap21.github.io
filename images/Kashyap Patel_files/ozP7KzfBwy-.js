if (self.CavalryLogger) { CavalryLogger.start_js(["HBK9M"]); }

__d("TagTokenizer",["fbt","Arbiter","CSS","DOM","Parent","TagToken","Tokenizer","createObjectFrom","ge","getElementText"],(function(a,b,c,d,e,f,g){__p&&__p();var h;c=babelHelpers.inherits(a,b("Tokenizer"));h=c&&c.prototype;function a(a,c,d,e,f){"use strict";h.constructor.call(this,d,e,f),b("Arbiter").subscribe("PhotoInlineEditor.CANCEL_INLINE_EDITING",this.updateTokenareaVisibility.bind(this),"new"),this.appphoto=c,b("Arbiter").subscribe(a.getInstance().getEventString("DATA_CHANGE"),this.setup.bind(this),"new")}a.prototype.setup=function(a,b){"use strict";this.appphoto=b.byapp;this.byowner=b.isowner;return this.reset()};a.prototype.reset=function(){"use strict";var a=this.getTokenElements().map(this.getTokenDataFromTag,this);this.withTagKeys={};var c=this.getWithTagTokenElements().map(function(a){return this._tokenKey(this.getTokenDataFromTag(a))}.bind(this));this.withTagKeys=b("createObjectFrom")(c);return h.reset.call(this,a)};a.prototype.processEvents=function(event,a,c){"use strict";if(b("Parent").byClass(a,"remove")){c=this.getTokenFromElement(c);c=this.addTokenData(c,a);this.removeToken(c);event.kill()}};a.prototype.insertToken=function(a){"use strict";return null};a.prototype.removeToken=function(a){"use strict";if(this.appphoto)return this.replaceToken(a);else this.inform("removeToken",a),b("Arbiter").inform("Form/change",{node:this.element});return null};a.prototype.addTokenData=function(a,c){"use strict";b("Parent").byClass(c,"blockuser")&&(a.blockUser=!0);return a};a.prototype.getTokenDataFromTag=function(a){"use strict";return{uid:b("DOM").find(a,"input").value,text:b("getElementText")(b("DOM").find(a,".taggee"))}};a.prototype.getTokenElementFromTarget=function(a){"use strict";return b("Parent").byClass(a,"tagItem")};a.prototype.getTokenElements=function(){"use strict";return b("DOM").scry(this.tokenarea,"span.tagItem").filter(this.filterNonTokenElements,this)};a.prototype.getWithTagTokenElements=function(){"use strict";return b("DOM").scry(this.tokenarea,"span.withTagItem")};a.prototype.filterNonTokenElements=function(a){"use strict";return!b("CSS").hasClass(a,"markasspam")&&!b("CSS").hasClass(a,"reported")&&!b("CSS").hasClass(a,"withTagItem")};a.prototype.createToken=function(a,c){"use strict";var d=this.getToken(this._tokenKey(a));d=d||new(b("TagToken"))(a);c&&d.setElement(c);return d};a.prototype.updateTokenareaVisibility=function(){"use strict";var a=this.getTokenElements().filter(function(a){return b("CSS").shown(a)}),c=this.getWithTagTokenElements(),d=b("DOM").scry(this.tokenarea,"span.ogTagItem");b("CSS").conditionShow(this.tokenarea,a.length!==0||c.length!==0||d.length!==0)};a.prototype.replaceToken=function(a){"use strict";__p&&__p();if(!a)return;var c=this.tokens.indexOf(a);if(c<0)return;this.tokens.splice(this.tokens.indexOf(a),1);delete this.unique[this._tokenKey(a.getInfo())];c=b("ge")("tagspam"+a.getValue());c&&b("DOM").remove(c);c=[" [",g._("Tag Removed.")," "];c.push(b("DOM").create("a",{onclick:this.markAsSpam.bind(this,a.getValue())},g._("Mark tag as spam")));c.push("] ");c=b("DOM").create("span",{className:"fbPhotosTaglistTag tagItem markasspam",id:"tagspam"+a.getValue()},c);b("DOM").replace(a.getElement(),c);this.updateTokenarea();this.inform("removeToken",a);b("Arbiter").inform("Form/change",{node:this.element})};a.prototype.markAsSpam=function(a){"use strict";var c=b("ge")("tagspam"+a),d=[" [",g._("Tag Reported"),"] "];d=b("DOM").create("span",{className:"fbPhotosTaglistTag tagItem reported",id:"tagspam"+a},d);b("DOM").replace(c,d);this.inform("markTagAsSpam",a)};a.prototype.removeTokenForSpatialTag=function(a){"use strict";h.removeToken.call(this,a)};e.exports=a}),null);